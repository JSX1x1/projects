#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <direct.h>  // For _rmdir on Windows
#include <unistd.h>  // For rmdir on Linux/Mac
#include <errno.h>

#ifdef _WIN32
#include <windows.h>
#define CLEAR "cls"
#else
#include <sys/stat.h>
#define CLEAR "clear"
#endif

// ‚ö†Ô∏è WARNING: This script can delete entire directories permanently!
// ‚ö†Ô∏è Misuse of this code may lead to irreversible data loss or system damage.
// ‚ö†Ô∏è Do NOT execute this script on any system without explicit permission.
// ‚ö†Ô∏è The author is NOT responsible for any damage caused by misuse!
// ‚ö†Ô∏è Running this script with administrative/root permissions can delete protected system files!

// Function to validate the path and prevent deletion of critical system directories
int isPathSafe(const char *path) {
#ifdef _WIN32
    // Windows: Block deletion of critical system paths
    if (strstr(path, "C:\\Windows") != NULL || strstr(path, "C:\\Windows\\System32") != NULL ||
        strstr(path, "C:\\Program Files") != NULL || strstr(path, "C:\\Program Files (x86)") != NULL) {
        printf("[!] Cannot delete critical system paths. Operation aborted.\n");
        return 0;
    }
#else
    // Linux/Mac: Block deletion of critical system paths
    if (strcmp(path, "/") == 0 || strcmp(path, "/root") == 0 || strstr(path, "/bin") != NULL ||
        strstr(path, "/sbin") != NULL || strstr(path, "/usr") != NULL || strstr(path, "/etc") != NULL) {
        printf("[!] Cannot delete critical system paths. Operation aborted.\n");
        return 0;
    }
#endif
    return 1;
}

// Function to delete a directory based on the operating system
void deleteDirectory(const char *path) {
    char command[1024];

#ifdef _WIN32
    // Windows command to delete a directory forcefully and quietly
    snprintf(command, sizeof(command), "rd /s /q \"%s\"", path);
#else
    // Linux/Mac command to delete a directory recursively and forcefully
    snprintf(command, sizeof(command), "rm -rf \"%s\"", path);
#endif

    // Execute the delete command and check for errors
    int status = system(command);
    if (status != 0) {
        // ‚ö†Ô∏è Error handling: Display error code if deletion fails
        printf("[!] Failed to delete %s. Error code: %d\n", path, status);
    } else {
        // üëç Success message if deletion is successful
        printf("[+] Successfully deleted %s\n", path);
    }
}

int main() {
    char path[512];

    // Clear the console for better readability
    system(CLEAR);

    // Display a clear warning to the user
    printf("‚ö†Ô∏è WARNING: This script can delete entire directories permanently!\n");
    printf("Do NOT misuse this code. The author is NOT responsible for any damage.\n\n");

    // Prompt user for the absolute path to delete
    printf("[?] Enter the absolute path to delete: ");
    fgets(path, sizeof(path), stdin);
    path[strcspn(path, "\n")] = 0;  // Remove newline character

    // Validate if the provided path is too short or seems suspicious
    if (strlen(path) < 3) {
        // ‚ö†Ô∏è Path validation: Prevent deletion of critical paths like C:\ or /
        printf("[!] Invalid path. Aborting.\n");
        return 1;
    }

    // Check if the path is safe to delete
    if (!isPathSafe(path)) {
        return 1;  // Abort if path is unsafe
    }

    // Display the path to be deleted for user confirmation
    printf("\n[!] You are about to delete: %s\n", path);
    printf("[!] This action is IRREVERSIBLE. Proceed with caution.\n");

    // Request user confirmation to proceed with deletion
    char confirmation[8];
    printf("[?] Type 'CONFIRM' to proceed: ");
    fgets(confirmation, sizeof(confirmation), stdin);
    confirmation[strcspn(confirmation, "\n")] = 0;  // Remove newline character

    // Proceed only if user types 'CONFIRM'
    if (strcmp(confirmation, "CONFIRM") == 0) {
        deleteDirectory(path);  // Call function to delete the specified path
    } else {
        // ‚ö†Ô∏è Aborted: User did not confirm with 'CONFIRM'
        printf("[!] Aborted by user.\n");
    }

    return 0;
}