#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#ifdef _WIN32
#include <windows.h>
#define CLEAR "cls"
#else
#include <unistd.h>
#define CLEAR "clear"
#endif

// ⚠️ WARNING: This script can lock folders even from administrators!
// ⚠️ Misuse of this code may lead to irreversible access denial!
// ⚠️ Only use this script if you know what you are doing!
// ⚠️ The author is NOT responsible for any damage caused by misuse!

// Function to lock a directory based on the operating system
void lockDirectory(const char *path) {
    char command[1024];

#ifdef _WIN32
    // Windows: Use icacls to deny access to everyone
    snprintf(command, sizeof(command), "icacls \"%s\" /deny Everyone:(F)", path);
#else
    // Linux/Mac: Use chmod to set restrictive permissions (000)
    snprintf(command, sizeof(command), "chmod 000 \"%s\"", path);
#endif

    // Execute the lock command and check for errors
    int status = system(command);
    if (status != 0) {
        printf("[!] Failed to lock %s. Error code: %d\n", path, status);
    } else {
        printf("[+] Successfully locked %s\n", path);
    }
}

// Function to unlock a directory based on the operating system
void unlockDirectory(const char *path) {
    char command[1024];

#ifdef _WIN32
    // Windows: Restore permissions using icacls
    snprintf(command, sizeof(command), "icacls \"%s\" /grant Everyone:(F)", path);
#else
    // Linux/Mac: Restore permissions using chmod (755 for full access)
    snprintf(command, sizeof(command), "chmod 755 \"%s\"", path);
#endif

    // Execute the unlock command and check for errors
    int status = system(command);
    if (status != 0) {
        printf("[!] Failed to unlock %s. Error code: %d\n", path, status);
    } else {
        printf("[+] Successfully unlocked %s\n", path);
    }
}

int main() {
    char path[512];
    int choice;

    // Clear the console for better readability
    system(CLEAR);

    // Display a clear warning to the user
    printf("⚠️ WARNING: This script can lock folders even from administrators!\n");
    printf("Use at your own risk. The author is NOT responsible for any damage.\n\n");

    // Prompt user for the absolute path to lock
    printf("[?] Enter the absolute path to lock: ");
    fgets(path, sizeof(path), stdin);
    path[strcspn(path, "\n")] = 0;  // Remove newline character

    // Validate if the provided path is too short or seems suspicious
    if (strlen(path) < 3) {
        printf("[!] Invalid path. Aborting.\n");
        return 1;
    }

    // Display options to lock or unlock the path
    printf("\n[1] Lock Path\n[2] Unlock Path\n[?] Choose an option: ");
    scanf("%d", &choice);

    if (choice == 1) {
        lockDirectory(path);  // Call function to lock the path
    } else if (choice == 2) {
        unlockDirectory(path);  // Call function to unlock the path
    } else {
        printf("[!] Invalid choice. Aborting.\n");
    }

    return 0;
}
